"""Malware

The origin of this code is from: 
https://github.com/amir78729/python-TCP-client-server-template/blob/main/Client.py
"""

import platform
import subprocess

import psutil
import re
import socket
import uuid
import os
import time
import locale


class Client:
    def __init__(self):
        self.PORT = 9999
        self.MESSAGE_LENGTH_SIZE = 64
        self.ENCODING = 'utf-8'
        self.ADDRESS = '127.0.0.1'
        self.SERVER_INFORMATION = (self.ADDRESS, self.PORT)
        self.system_info = {}

    def get_system_info(self):
        self.system_info['Host Name'] = socket.gethostname()
        self.system_info['OS Name'] = platform.system()
        self.system_info['OS Version'] = platform.release()
        self.system_info['OS Manufacturer'] = '?'
        self.system_info['OS Configuration'] = platform.machine()
        self.system_info['Registered Owner'] = '?'
        self.system_info['Registered Organization'] = '?'
        self.system_info['Product ID'] = '?'
        self.system_info['Original Install Date'] = '?'
        self.system_info['System Boot Time'] = str(psutil.boot_time()) + 's'
        self.system_info['System Manufacturer'] = '?'
        self.system_info['System Model'] = '?'
        self.system_info['System Type'] = '?'
        self.system_info['Processor(s)'] = platform.processor()
        self.system_info['BIOS Version'] = '?'
        self.system_info['Windows Directory'] = '?'
        self.system_info['System Directory'] = '?'
        self.system_info['Boot Device'] = '?'
        self.system_info['System Locale'] = '{}({})'.format(locale.getdefaultlocale()[0], locale.getdefaultlocale()[1])
        self.system_info['Input Locale'] = '?'
        self.system_info['Time Zone'] = time.tzname[0]
        self.system_info['Total Physical Memory'] = '?'
        self.system_info['Available Physical Memory'] = '?'
        self.system_info['Virtual Memory: Max Size'] = str(round(psutil.virtual_memory().total / (1024.0 ** 3), 4)) + " GB"
        self.system_info['Virtual Memory: Available'] = str(round(psutil.virtual_memory().available / (1024.0 ** 3), 4)) + " GB"
        self.system_info['Virtual Memory: In Use'] = str(
            round(psutil.virtual_memory().total / (1024.0 ** 3), 4) -
            round(psutil.virtual_memory().available / (1024.0 ** 3), 4)
        ) + " GB"
        self.system_info['Page File Location(s)'] = '?'
        self.system_info['Domain'] = '?'
        self.system_info['Logon Server'] = '?'
        self.system_info['Hotfix(s)'] = '?'

        self.system_info['OS Architecture'] = platform.machine()
        self.system_info['Mac Address'] = ':'.join(re.findall('..', '%012x' % uuid.getnode()))
        self.system_info['RAM'] = str(round(psutil.virtual_memory().total / (1024.0 ** 3))) + " GB"

    def stringify_system_info(self):
        res = '\n-------\n'
        for info in self.system_info.keys():
            res += '{}: {}\n'.format(info, self.system_info[info])
        return res

    def main(self):
        self.get_system_info()

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect(self.SERVER_INFORMATION)
        # self.send_message(s, self.stringify_system_info())

        while True:
            user_input = input('enter your message (type "/q" to exit)'.upper())
            if user_input.upper() == '/Q':
                break
            else:
                self.send_message(s, user_input)
    
    def send_message(self, client, msg):
        message = msg.encode(self.ENCODING)
        msg_length = len(message)
        msg_length = str(msg_length).encode(self.ENCODING)
        msg_length += b' ' * (self.MESSAGE_LENGTH_SIZE - len(msg_length))
        client.send(msg_length)
        client.send(message)


if __name__ == '__main__':
    client = Client()
    client.main()